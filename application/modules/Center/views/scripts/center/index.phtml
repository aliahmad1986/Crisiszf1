<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Centers Management</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addCenterModal">
                            <i class="fa fa-plus"></i> Add New Center
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <table id="centersTable" class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Center Name</th>
                                <th>Type</th>
                                <th>Address</th>
                                <th>Phone</th>
                                <th>Website</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Created By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Center Modal - Same structure as Add User Modal -->
<div class="modal fade" id="addCenterModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Center</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="addCenterFormContainer">
                <!-- Form will be loaded via AJAX -->
            </div>
        </div>
    </div>
</div>

<!-- Edit Center Modal - Same structure as Edit User Modal -->
<div class="modal fade" id="editCenterModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Center</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="editCenterFormContainer">
                <!-- Form will be loaded via AJAX -->
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal - Identical to Users -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this center?</p>
                <input type="hidden" id="deleteCenterId">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Initialize DataTable - Same configuration as users
    var table = $('#centersTable').DataTable({
        "processing": true,
        "serverSide": false,
        "ajax": {
            "url": "<?php echo $this->url(array('module' => 'Center', 'controller' => 'center', 'action' => 'index'), 'default', true); ?>",
            "type": "POST"
        },
        "columns": [
            {"data": "CenterID"},
            {"data": "CenterName"},
            {"data": "CenterTypeName"},
            {"data": "Address"},
            {"data": "Phone1"},
            {"data": "Website"},
            {"data": "IsActive"},
            {"data": "CreatedAt"},
            {"data": "CreatedByName"},
            {"data": "Actions", "orderable": false}
        ],
        "responsive": true,
        "pageLength": 25
    });

    // Load add center form - Same as users
    $('#addCenterModal').on('show.bs.modal', function() {
        $('#addCenterFormContainer').load('<?php echo $this->url(array('module' => 'Center', 'controller' => 'center', 'action' => 'add-center'), 'default', true); ?>');
    });

    // Submit add center form - Same as users
    $(document).on('submit', '#addCenterForm', function(e) {
        e.preventDefault();
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                var result = JSON.parse(response);
                if (result.success) {
                    $('#addCenterModal').modal('hide');
                    table.ajax.reload();
                    showAlert('success', result.message);
                } else {
                    showAlert('error', result.message);
                }
            }
        });
    });

    // Load edit center form - Same as users
    $(document).on('click', '.edit-center', function() {
        var centerId = $(this).data('id');
        $('#editCenterFormContainer').load('<?php echo $this->url(array('module' => 'Center', 'controller' => 'center', 'action' => 'edit-center'), 'default', true); ?>?id=' + centerId, function() {
            $('#editCenterModal').modal('show');
        });
    });

    // Submit edit center form - Same as users
    $(document).on('submit', '#editCenterForm', function(e) {
        e.preventDefault();
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                var result = JSON.parse(response);
                if (result.success) {
                    $('#editCenterModal').modal('hide');
                    table.ajax.reload();
                    showAlert('success', result.message);
                } else {
                    showAlert('error', result.message);
                }
            }
        });
    });

    // Delete center - Same as users
    $(document).on('click', '.delete-center', function() {
        var centerId = $(this).data('id');
        $('#deleteCenterId').val(centerId);
        $('#deleteModal').modal('show');
    });

    // Confirm delete - Same as users
    $('#confirmDelete').click(function() {
        var centerId = $('#deleteCenterId').val();
        $.ajax({
            url: '<?php echo $this->url(array('module' => 'Center', 'controller' => 'center', 'action' => 'delete'), 'default', true); ?>',
            type: 'POST',
            data: {id: centerId},
            success: function(response) {
                var result = JSON.parse(response);
                if (result.success) {
                    $('#deleteModal').modal('hide');
                    table.ajax.reload();
                    showAlert('success', result.message);
                } else {
                    showAlert('error', result.message);
                }
            }
        });
    });

    // Check center name availability - Similar to username check
    $(document).on('blur', '#CenterName', function() {
        var centerName = $(this).val();
        var centerId = $(this).data('center-id') || 0;
        
        if (centerName.length > 2) {
            $.ajax({
                url: '<?php echo $this->url(array('module' => 'Center', 'controller' => 'center', 'action' => 'check-center-name'), 'default', true); ?>',
                type: 'GET',
                data: {centerName: centerName, centerId: centerId},
                success: function(response) {
                    var result = JSON.parse(response);
                    var input = $('#CenterName');
                    var feedback = input.parent().find('.center-name-feedback');
                    
                    if (!feedback.length) {
                        feedback = $('<div class="center-name-feedback mt-1"></div>');
                        input.parent().append(feedback);
                    }
                    
                    if (result.available) {
                        feedback.html('<span class="text-success"><i class="fa fa-check"></i> ' + result.message + '</span>');
                        input.removeClass('is-invalid').addClass('is-valid');
                    } else {
                        feedback.html('<span class="text-danger"><i class="fa fa-times"></i> ' + result.message + '</span>');
                        input.removeClass('is-valid').addClass('is-invalid');
                    }
                }
            });
        }
    });

    // Alert function - Identical to users
    function showAlert(type, message) {
        var alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
        var alertHtml = '<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert">' +
            message +
            '<button type="button" class="close" data-dismiss="alert">' +
            '<span>&times;</span>' +
            '</button>' +
            '</div>';
        
        $('.container-fluid').prepend(alertHtml);
        
        setTimeout(function() {
            $('.alert').alert('close');
        }, 5000);
    }
});
</script>