<?php 
$translate = $this->translate;
?>
<form id="addCrisisForm" method="post" action="<?php echo $this->url(array('module' => 'Crisis', 'controller' => 'crisis', 'action' => 'add-crisis'), null, true); ?>">
    <div class="form-group">
        <label for="CrisisCode"><?php echo $translate->_('Crisis Code'); ?> *</label>
        <input type="text" class="form-control" id="CrisisCode" name="CrisisCode" required 
               placeholder="<?php echo $translate->_('e.g., CRS-001'); ?>">
        <small class="form-text text-muted"><?php echo $translate->_('Unique code for the crisis'); ?></small>
    </div>
    
    <div class="form-group">
        <label for="CrisisTitle"><?php echo $translate->_('Crisis Title'); ?> *</label>
        <input type="text" class="form-control" id="CrisisTitle" name="CrisisTitle" required 
               placeholder="<?php echo $translate->_('Enter crisis title'); ?>">
        <small class="form-text text-muted"><?php echo $translate->_('Brief title describing the crisis'); ?></small>
    </div>
    
    <div class="form-group">
        <label for="CrisisTypeID"><?php echo $translate->_('Crisis Type'); ?> *</label>
        <select class="form-control" id="CrisisTypeID" name="CrisisTypeID" required>
            <option value=""><?php echo $translate->_('Select Type'); ?></option>
            <?php foreach ($this->crisisTypes as $type): ?>
            <option value="<?php echo $type['BaseInfoID']; ?>">
                <?php echo htmlspecialchars($type['Name'], ENT_QUOTES, 'UTF-8'); ?>
            </option>
            <?php endforeach; ?>
        </select>
    </div>
    
    <div class="form-group">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="IsActive" name="IsActive" value="1" checked>
            <label class="custom-control-label" for="IsActive"><?php echo $translate->_('Active'); ?></label>
        </div>
    </div>
    
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
            <i class="fa fa-times"></i> <?php echo $translate->_('Cancel'); ?>
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fa fa-save"></i> <?php echo $translate->_('Save Crisis'); ?>
        </button>
    </div>
</form>

<script>
$(document).ready(function() {
    $('#addCrisisForm').on('submit', function(e) {
        e.preventDefault();
        
        // Basic validation
        if (!$('#CrisisCode').val() || !$('#CrisisTitle').val() || !$('#CrisisTypeID').val()) {
            alert('<?php echo $translate->_("Please fill all required fields"); ?>');
            return false;
        }
        
        $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(response) {
                var result = JSON.parse(response);
                if (result.success) {
					    Swal.fire({
                            icon: 'success',
                            title: '<?php echo $translate->_("Inserted!"); ?>',
                            text: result.message,
                            timer: 2000,
                            showConfirmButton: false
                        });
                  
                    $('#addCrisisModal').modal('hide');
                    $('#crisesTable').DataTable().ajax.reload();
                } else {
                    alert(result.message);
                }
            }
        });
    });
});
</script>